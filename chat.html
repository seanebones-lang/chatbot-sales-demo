<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Knowledge Chat - Complete Search & Guidance</title>
    <meta name="description" content="Ask any question about Islam, Quran, Hadith, Fiqh, and more. Complete Islamic knowledge search system with AI-powered responses.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #E0E0E0;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(18, 18, 18, 0.8);
            border-radius: 20px;
            border: 1px solid rgba(68, 68, 68, 0.5);
        }
        
        .header h1 {
            color: #FFD700;
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        
        .header p {
            color: #87CEEB;
            font-size: 1.2rem;
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 15px 25px;
            background: linear-gradient(135deg, #1E90FF 0%, #004D61 100%);
            color: white;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(30, 144, 255, 0.3);
        }
        
        .search-section {
            background: rgba(24, 24, 24, 0.9);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(68, 68, 68, 0.5);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }
        
        .search-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid rgba(68, 68, 68, 0.5);
            border-radius: 15px;
            background: rgba(24, 24, 24, 0.8);
            color: #E0E0E0;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #1E90FF;
            box-shadow: 0 0 20px rgba(30, 144, 255, 0.3);
            background: rgba(24, 24, 24, 0.95);
        }
        
        .chat-btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: #FFFFFF;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            background: #1e7e34;
        }
        
        .source-toggle {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .source-btn {
            padding: 15px 30px;
            background: rgba(68, 68, 68, 0.5);
            border: 2px solid rgba(68, 68, 68, 0.8);
            border-radius: 15px;
            color: #b0c4de;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            font-weight: bold;
        }
        
        .source-btn.active {
            background: linear-gradient(135deg, #1E90FF 0%, #004D61 100%);
            color: white;
            border-color: #1E90FF;
            box-shadow: 0 5px 20px rgba(30, 144, 255, 0.3);
        }
        
        .source-btn:hover {
            transform: translateY(-2px);
        }
        
        .results-section {
            display: none;
            background: rgba(24, 24, 24, 0.9);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(68, 68, 68, 0.5);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }
        
        .results-section.show {
            display: block;
            animation: fadeInUp 1s ease-out;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Chat Interface Styles */
        .chat-container {
            background: rgba(24, 24, 24, 0.9);
            border-radius: 20px;
            border: 1px solid rgba(68, 68, 68, 0.5);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(18, 18, 18, 0.8);
        }
        
        .message {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .user-message {
            align-items: flex-end;
        }
        
        .bot-message {
            align-items: flex-start;
        }
        
        .message-content {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 18px;
            line-height: 1.6;
        }
        
        .user-message .message-content {
            background: linear-gradient(135deg, #1E90FF 0%, #004D61 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message .message-content {
            background: rgba(68, 68, 68, 0.8);
            color: #E0E0E0;
            border-bottom-left-radius: 5px;
        }
        
        .message-content h3 {
            margin: 0 0 10px 0;
            color: #FFD700;
        }
        
        .message-content p {
            margin: 0 0 10px 0;
        }
        
        .message-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .message-content li {
            margin: 5px 0;
        }
        
        .chat-input-area {
            display: flex;
            gap: 10px;
            padding: 20px;
            background: rgba(24, 24, 24, 0.95);
            border-top: 1px solid rgba(68, 68, 68, 0.3);
        }
        
        .chat-input-area input {
            flex: 1;
            margin: 0;
        }
        
        .send-btn {
            padding: 15px 25px;
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.3);
        }
        
        .results-count {
            color: #87CEEB;
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .ai-summary {
            background: rgba(18, 18, 18, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #FFD700;
        }
        
        .ai-summary h3 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }
        
        .suggestions {
            margin-top: 20px;
        }
        
        .suggestions h4 {
            color: #87CEEB;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .suggestion-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .suggestion-btn {
            padding: 8px 15px;
            background: rgba(30, 144, 255, 0.2);
            border: 1px solid rgba(30, 144, 255, 0.5);
            border-radius: 10px;
            color: #87CEEB;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .suggestion-btn:hover {
            background: rgba(30, 144, 255, 0.3);
            border-color: #1E90FF;
        }
        
        .verse-item {
            background: rgba(18, 18, 18, 0.8);
            border: 1px solid rgba(68, 68, 68, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }
        
        .verse-item:hover {
            border-color: #1E90FF;
            box-shadow: 0 10px 25px rgba(30, 144, 255, 0.2);
        }
        
        .verse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .verse-reference {
            color: #1E90FF;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .verse-source {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .verse-topic {
            background: rgba(30, 144, 255, 0.2);
            color: #1E90FF;
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .verse-text {
            margin-bottom: 15px;
        }
        
        .arabic-text {
            color: #98FB98;
            font-size: 1.3rem;
            margin: 15px 0;
            text-align: center;
            direction: rtl;
            line-height: 2;
        }
        
        .translation {
            color: #E0E0E0;
            font-size: 1.1rem;
            margin: 15px 0;
            line-height: 1.6;
        }
        
        .context {
            color: #87CEEB;
            font-size: 1rem;
            margin: 15px 0;
            font-style: italic;
            background: rgba(135, 206, 235, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 3px solid #87CEEB;
        }
        
        .verse-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 15px;
            background: rgba(68, 68, 68, 0.5);
            border: 1px solid rgba(68, 68, 68, 0.8);
            border-radius: 8px;
            color: #b0c4de;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .action-btn:hover {
            background: rgba(68, 68, 68, 0.7);
            color: #E0E0E0;
        }
        
        .no-results {
            text-align: center;
            padding: 30px;
        }
        
        .no-results h3 {
            color: #FFD700;
            margin-bottom: 15px;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            color: #87CEEB;
        }
        
        .spinner {
            border: 4px solid rgba(30, 144, 255, 0.3);
            border-top: 4px solid #1E90FF;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .search-input {
                flex-direction: column;
            }
            
            .source-toggle {
                flex-direction: column;
                align-items: center;
            }
            
            .verse-actions {
                flex-direction: column;
            }
            
            .back-btn {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" onclick="goBack()">Back to Main</button>
    
    <div class="container">
        <div class="header">
            <h1>Islamic Knowledge Chat</h1>
            <p>Ask any question about Islam, Quran, Hadith, and more</p>
        </div>
        
        <div class="search-section">
            <div class="search-input">
                <input type="text" id="searchInput" placeholder="Type your Islamic question for DeenBot (e.g., 'What does Islam say about mercy?', 'How to pray?', 'Inheritance laws?')" onkeypress="handleSearch(event)">
                <button onclick="testChatbot()" class="chat-btn">DeenBot</button>
            </div>
            
            <div class="source-toggle">
                <button class="source-btn active" onclick="setSource('all')">All Sources</button>
                <button class="source-btn" onclick="setSource('quran')">Quran Only</button>
                <button class="source-btn" onclick="setSource('hadith')">Hadith Only</button>
                <button class="source-btn" onclick="setSource('fiqh')">Fiqh (Islamic Law)</button>
                <button class="source-btn" onclick="setSource('new-muslim')">New Muslim Guide</button>
                <button class="source-btn" onclick="setSource('what-is-islam')">What is Islam?</button>
                <button class="source-btn" onclick="setSource('five-pillars')">Five Pillars</button>
                <button class="source-btn" onclick="setSource('sunnah')">Sunnah</button>
                <button class="source-btn" onclick="setSource('family-daily-life')">Family & Daily Life</button>
            </div>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <button onclick="testDeenBot()" style="padding: 15px 30px; background: #28a745; color: white; border: none; border-radius: 10px; font-size: 16px; cursor: pointer;">
                üß™ Test DeenBot (Click to test)
            </button>
        </div>
        
        <div class="chat-container" id="chatContainer" style="display: block !important;">
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message">
                    <div class="message-content">
                        <h3>Assalamu alaikum! üåü</h3>
                        <p>I'm <strong>DeenBot</strong>, your Islamic AI assistant, ready to help you learn about Islam, Quran, Hadith, Fiqh, and more. Ask me anything!</p>
                        <p><strong>Try asking about:</strong></p>
                        <ul>
                            <li>What does Islam say about mercy?</li>
                            <li>How to pray properly?</li>
                            <li>Inheritance laws in Islam</li>
                            <li>Family relationships and guidance</li>
                            <li>Daily life and moral boundaries</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="chat-input-area">
                <input type="text" id="chatInput" placeholder="Ask DeenBot anything about Islam..." onkeypress="handleChatKeyPress(event)">
                <button onclick="sendChatMessage()" class="send-btn">Send</button>
            </div>
        </div>
        
        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="results-count" id="resultsCount"></div>
            <div id="verseResults"></div>
        </div>
    </div>
    
    <script>
        // Full Islamic Knowledge System
        let currentSource = 'all';
        
        // Islamic Knowledge Databases
        const islamicDatabase = [
            // Family and Relationships
            {
                reference: "Al-Baqarah 2:187",
                arabic: "ŸáŸèŸÜŸéŸë ŸÑŸêÿ®Ÿéÿßÿ≥Ÿå ŸÑŸéŸÉŸèŸÖŸí ŸàŸéÿ£ŸéŸÜŸíÿ™ŸèŸÖŸí ŸÑŸêÿ®Ÿéÿßÿ≥Ÿå ŸÑŸéŸáŸèŸÜŸéŸë",
                translation: "They are clothing for you and you are clothing for them.",
                context: "This verse beautifully describes the relationship between spouses - they are like clothing that protects, covers, and beautifies each other.",
                topic: "Family",
                source: "Quran",
                category: "Family Relations",
                keywords: ["family", "marriage", "spouses", "relationship", "love", "protection", "unity"]
            },
            {
                reference: "Al-Rum 30:21",
                arabic: "ŸàŸéŸÖŸêŸÜŸí ÿ¢ŸäŸéÿßÿ™ŸêŸáŸê ÿ£ŸéŸÜŸí ÿÆŸéŸÑŸéŸÇŸé ŸÑŸéŸÉŸèŸÖŸí ŸÖŸêŸÜŸí ÿ£ŸéŸÜŸíŸÅŸèÿ≥ŸêŸÉŸèŸÖŸí ÿ£Ÿéÿ≤ŸíŸàŸéÿßÿ¨Ÿãÿß ŸÑŸêÿ™Ÿéÿ≥ŸíŸÉŸèŸÜŸèŸàÿß ÿ•ŸêŸÑŸéŸäŸíŸáŸéÿß ŸàŸéÿ¨ŸéÿπŸéŸÑŸé ÿ®ŸéŸäŸíŸÜŸéŸÉŸèŸÖŸí ŸÖŸéŸàŸéÿØŸéŸëÿ©Ÿã ŸàŸéÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿã",
                translation: "And of His signs is that He created for you from yourselves mates that you may find tranquility in them; and He placed between you affection and mercy.",
                context: "Allah created spouses to bring tranquility, affection, and mercy to our lives. This is the foundation of a healthy family.",
                topic: "Family",
                source: "Quran",
                category: "Family Relations",
                keywords: ["family", "marriage", "tranquility", "affection", "mercy", "spouses", "love"]
            },
            // Daily Life Guidance
            {
                reference: "Al-Baqarah 2:168",
                arabic: "ŸäŸéÿß ÿ£ŸéŸäŸèŸëŸáŸéÿß ÿßŸÑŸÜŸéŸëÿßÿ≥Ÿè ŸÉŸèŸÑŸèŸàÿß ŸÖŸêŸÖŸéŸëÿß ŸÅŸêŸä ÿßŸÑŸíÿ£Ÿéÿ±Ÿíÿ∂Ÿê ÿ≠ŸéŸÑŸéÿßŸÑŸãÿß ÿ∑ŸéŸäŸêŸëÿ®Ÿãÿß",
                translation: "O mankind, eat from whatever is on earth [that is] lawful and good.",
                context: "Islam teaches us to consume only what is halal (permissible) and tayyib (good/wholesome) in our daily lives.",
                topic: "Daily Life",
                source: "Quran",
                category: "Daily Living",
                keywords: ["daily life", "food", "halal", "tayyib", "permissible", "wholesome", "consumption"]
            },
            {
                reference: "Al-Isra 17:32",
                arabic: "ŸàŸéŸÑŸéÿß ÿ™ŸéŸÇŸíÿ±Ÿéÿ®ŸèŸàÿß ÿßŸÑÿ≤ŸêŸëŸÜŸéÿß €ñ ÿ•ŸêŸÜŸéŸëŸáŸè ŸÉŸéÿßŸÜŸé ŸÅŸéÿßÿ≠Ÿêÿ¥Ÿéÿ©Ÿã ŸàŸéÿ≥Ÿéÿßÿ°Ÿé ÿ≥Ÿéÿ®ŸêŸäŸÑŸãÿß",
                translation: "And do not approach unlawful sexual intercourse. Indeed, it is an immorality and an evil way.",
                context: "Islam provides clear guidance on maintaining moral boundaries in daily life and relationships.",
                topic: "Daily Life",
                source: "Quran",
                category: "Daily Living",
                keywords: ["daily life", "morality", "boundaries", "relationships", "purity", "guidance"]
            }
        ];
        
        const hadithDatabase = [
            {
                reference: "Sahih Bukhari 5:78 - Family",
                arabic: "ÿÆŸéŸäŸíÿ±ŸèŸÉŸèŸÖŸí ÿÆŸéŸäŸíÿ±ŸèŸÉŸèŸÖŸí ŸÑŸêÿ£ŸéŸáŸíŸÑŸêŸáŸê",
                translation: "The best of you is the best to his family.",
                context: "The Prophet (PBUH) emphasizes treating family members with kindness and respect.",
                topic: "Family",
                source: "Hadith",
                authentication: "Sahih (Authentic)",
                narrator: "Abu Huraira",
                keywords: ["family", "best", "kindness", "respect", "treatment", "relationships"]
            },
            {
                reference: "Sahih Muslim - Daily Life",
                arabic: "ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ÿ¨ŸéŸÖŸêŸäŸÑŸå ŸäŸèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíÿ¨ŸéŸÖŸéÿßŸÑŸé",
                translation: "Indeed, Allah is beautiful and He loves beauty.",
                context: "This Hadith teaches us that Allah appreciates beauty and cleanliness in our daily lives.",
                topic: "Daily Life",
                source: "Hadith",
                authentication: "Sahih (Authentic)",
                narrator: "Various",
                keywords: ["daily life", "beauty", "cleanliness", "appreciation", "Allah", "guidance"]
            }
        ];
        
        const fiqhDatabase = [
            {
                reference: "Inheritance Laws - Al-Nisa 4:11-12",
                arabic: "ŸäŸèŸàÿµŸêŸäŸÉŸèŸÖŸè ÿßŸÑŸÑŸéŸëŸáŸè ŸÅŸêŸä ÿ£ŸéŸàŸíŸÑŸéÿßÿØŸêŸÉŸèŸÖŸí €ñ ŸÑŸêŸÑÿ∞ŸéŸëŸÉŸéÿ±Ÿê ŸÖŸêÿ´ŸíŸÑŸè ÿ≠Ÿéÿ∏ŸêŸë ÿßŸÑŸíÿ£ŸèŸÜŸíÿ´ŸéŸäŸéŸäŸíŸÜŸê",
                translation: "Allah instructs you concerning your children: for the male, what is equal to the share of two females.",
                context: "Basic principle of Islamic inheritance where males receive twice the share of females. This applies to children's inheritance from their parents. The male child receives twice the share of a female child.",
                topic: "Inheritance",
                source: "Fiqh",
                category: "Family Law",
                keywords: ["inheritance", "children", "males", "females", "shares", "family", "law", "parents", "distribution"]
            },
            {
                reference: "Spouse Inheritance - Al-Nisa 4:12",
                arabic: "ŸàŸéŸÑŸéŸÉŸèŸÖŸí ŸÜŸêÿµŸíŸÅŸè ŸÖŸéÿß ÿ™Ÿéÿ±ŸéŸÉŸé ÿ£Ÿéÿ≤ŸíŸàŸéÿßÿ¨ŸèŸÉŸèŸÖŸí ÿ•ŸêŸÜ ŸÑŸéŸëŸÖŸí ŸäŸéŸÉŸèŸÜ ŸÑŸéŸëŸáŸèŸÜŸéŸë ŸàŸéŸÑŸéÿØŸå",
                translation: "And for you is half of what your wives leave if they have no child.",
                context: "If a wife dies without children, her husband inherits half of her estate. If she has children, he gets one-fourth. This ensures fair distribution while maintaining family stability.",
                topic: "Inheritance",
                source: "Fiqh",
                category: "Family Law",
                keywords: ["inheritance", "spouse", "wife", "husband", "children", "estate", "distribution", "family law", "marriage"]
            },
            {
                reference: "Parent Inheritance - Al-Nisa 4:11",
                arabic: "ŸàŸéŸÑŸêÿ£Ÿéÿ®ŸéŸàŸéŸäŸíŸáŸê ŸÑŸêŸÉŸèŸÑŸêŸë ŸàŸéÿßÿ≠ŸêÿØŸç ŸÖŸêŸëŸÜŸíŸáŸèŸÖŸéÿß ÿßŸÑÿ≥ŸèŸëÿØŸèÿ≥Ÿè ŸÖŸêŸÖŸéŸëÿß ÿ™Ÿéÿ±ŸéŸÉŸé",
                translation: "And for one's parents, to each one of them is a sixth of what he left.",
                context: "Parents inherit one-sixth each from their deceased child's estate. This applies when the deceased has children. If no children, parents get more. This ensures parents are cared for in their old age.",
                topic: "Inheritance",
                source: "Fiqh",
                category: "Family Law",
                keywords: ["inheritance", "parents", "sixth", "estate", "children", "deceased", "care", "old age", "family law"]
            },
            {
                reference: "Sibling Inheritance - Al-Nisa 4:176",
                arabic: "ŸäŸéÿ≥Ÿíÿ™ŸéŸÅŸíÿ™ŸèŸàŸÜŸéŸÉŸé ŸÇŸèŸÑŸê ÿßŸÑŸÑŸéŸëŸáŸè ŸäŸèŸÅŸíÿ™ŸêŸäŸÉŸèŸÖŸí ŸÅŸêŸä ÿßŸÑŸíŸÉŸéŸÑŸéÿßŸÑŸéÿ©Ÿê",
                translation: "They request from you a [legal] ruling. Say, 'Allah gives you a ruling concerning one having neither descendants nor ascendants.'",
                context: "When someone dies without parents or children (kalalah), their siblings inherit. Brothers get twice the share of sisters. This ensures family wealth stays within the family unit.",
                topic: "Inheritance",
                source: "Fiqh",
                category: "Family Law",
                keywords: ["inheritance", "siblings", "brothers", "sisters", "kalalah", "no parents", "no children", "family wealth", "distribution"]
            },
            {
                reference: "Inheritance Calculation - Islamic Mathematics",
                arabic: "ŸÅŸéÿ±ŸêŸäÿ∂Ÿéÿ©Ÿã ŸÖŸêŸëŸÜŸé ÿßŸÑŸÑŸéŸëŸáŸê €ó ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ŸÉŸéÿßŸÜŸé ÿπŸéŸÑŸêŸäŸÖŸãÿß ÿ≠ŸéŸÉŸêŸäŸÖŸãÿß",
                translation: "An obligation from Allah. Indeed, Allah is ever Knowing and Wise.",
                context: "Islamic inheritance uses precise mathematical calculations to ensure fair distribution. The total estate is divided into shares (faraid) with specific fractions for each heir. This prevents disputes and ensures justice.",
                topic: "Inheritance",
                source: "Fiqh",
                category: "Family Law",
                keywords: ["inheritance", "calculation", "mathematics", "faraid", "shares", "fractions", "heirs", "disputes", "justice", "fair distribution"]
            },
            {
                reference: "Marriage Laws - Al-Nisa 4:4",
                arabic: "ŸàŸéÿ¢ÿ™ŸèŸàÿß ÿßŸÑŸÜŸêŸëÿ≥Ÿéÿßÿ°Ÿé ÿµŸéÿØŸèŸÇŸéÿßÿ™ŸêŸáŸêŸÜŸéŸë ŸÜŸêÿ≠ŸíŸÑŸéÿ©Ÿã",
                translation: "And give the women [upon marriage] their [bridal] gifts graciously.",
                context: "Islamic law requires the husband to give a mahr (bridal gift) to his wife as a sign of respect and commitment.",
                topic: "Marriage",
                source: "Fiqh",
                category: "Family Law",
                keywords: ["marriage", "mahr", "bridal gift", "respect", "commitment", "family law"]
            }
        ];
        
        const newMuslimDatabase = [
            {
                reference: "Shahada - Declaration of Faith",
                arabic: "ÿ£Ÿéÿ¥ŸíŸáŸéÿØŸè ÿ£ŸéŸÜŸí ŸÑŸéÿß ÿ•ŸêŸÑŸéŸ∞ŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸÑŸéŸëŸáŸè ŸàŸéÿ£Ÿéÿ¥ŸíŸáŸéÿØŸè ÿ£ŸéŸÜŸéŸë ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸãÿß ÿ±Ÿéÿ≥ŸèŸàŸÑŸè ÿßŸÑŸÑŸéŸëŸáŸê",
                translation: "I bear witness that there is no deity except Allah, and I bear witness that Muhammad is the Messenger of Allah.",
                context: "The first step for new Muslims - declaring faith in Allah and His Messenger. This is your entry into Islam.",
                topic: "Shahada",
                source: "New Muslim",
                category: "Basic Faith",
                keywords: ["shahada", "declaration", "faith", "allah", "muhammad", "messenger", "new muslim", "first step"]
            }
        ];
        
        const whatIsIslamDatabase = [
            {
                reference: "What is Islam? - Core Definition",
                arabic: "ÿ•ŸêŸÜŸéŸë ÿßŸÑÿØŸêŸëŸäŸÜŸé ÿπŸêŸÜÿØŸé ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑŸíÿ•Ÿêÿ≥ŸíŸÑŸéÿßŸÖŸè",
                translation: "Indeed, the religion in the sight of Allah is Islam",
                context: "Islam means 'submission to God' and 'peace.' It's a monotheistic faith that believes in one God (Allah) and follows the teachings of Prophet Muhammad (PBUH).",
                topic: "What is Islam",
                source: "What is Islam",
                category: "Basic Understanding",
                keywords: ["islam", "definition", "meaning", "monotheism", "one god", "allah", "prophets", "abraham", "moses", "jesus", "peace", "submission"]
            }
        ];
        
        const fivePillarsDatabase = [
            {
                reference: "First Pillar - Shahada",
                arabic: "ÿ£Ÿéÿ¥ŸíŸáŸéÿØŸè ÿ£ŸéŸÜŸí ŸÑŸéÿß ÿ•ŸêŸÑŸéŸ∞ŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿßŸÑŸÑŸéŸëŸáŸè ŸàŸéÿ£Ÿéÿ¥ŸíŸáŸéÿØŸè ÿ£ŸéŸÜŸéŸë ŸÖŸèÿ≠ŸéŸÖŸéŸëÿØŸãÿß ÿ±Ÿéÿ≥ŸèŸàŸÑŸè ÿßŸÑŸÑŸéŸëŸáŸê",
                translation: "I bear witness that there is no deity except Allah, and I bear witness that Muhammad is the Messenger of Allah.",
                context: "The Shahada is the first and most fundamental pillar of Islam. It's the declaration that makes a person a Muslim.",
                topic: "Five Pillars",
                source: "Five Pillars",
                category: "Basic Faith",
                keywords: ["shahada", "five pillars", "declaration", "faith", "allah", "muhammad", "messenger", "islam"]
            }
        ];
        
        const sunnahDatabase = [
            {
                reference: "Daily Sunnah - Morning",
                arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿµŸíÿ®Ÿéÿ≠Ÿíÿ™Ÿè ÿ£Ÿèÿ¥ŸíŸáŸêÿØŸèŸÉŸé ŸàŸéÿ£Ÿèÿ¥ŸíŸáŸêÿØŸè ÿ≠ŸéŸÖŸéŸÑŸéÿ©Ÿé ÿπŸéÿ±Ÿíÿ¥ŸêŸÉŸé ŸàŸéŸÖŸéŸÑŸéÿßÿ¶ŸêŸÉŸéÿ™ŸéŸÉŸé ŸàŸéÿ¨ŸéŸÖŸêŸäÿπŸé ÿÆŸéŸÑŸíŸÇŸêŸÉŸé ÿ£ŸéŸÜŸéŸëŸÉŸé ÿ£ŸéŸÜŸíÿ™Ÿé ÿßŸÑŸÑŸéŸëŸáŸè ŸÑŸéÿß ÿ•ŸêŸÑŸéŸáŸé ÿ•ŸêŸÑŸéŸëÿß ÿ£ŸéŸÜŸíÿ™Ÿé",
                translation: "O Allah, I have reached the morning and at this very time all things are subservient to You. I bear witness to You and bear witness to the bearers of Your Throne, Your angels, and all Your creatures.",
                context: "This is a beautiful morning supplication that the Prophet (PBUH) taught us to recite daily.",
                topic: "Sunnah",
                source: "Sunnah",
                category: "Daily Practices",
                keywords: ["sunnah", "morning", "supplication", "daily", "prophet", "guidance", "practices"]
            }
        ];
        
        // Family and Daily Life Database - Comprehensive Guidance
        const familyDailyLifeDatabase = [
            {
                reference: "Family Relations - Al-Baqarah 2:187",
                arabic: "ŸáŸèŸÜŸéŸë ŸÑŸêÿ®Ÿéÿßÿ≥Ÿå ŸÑŸéŸÉŸèŸÖŸí ŸàŸéÿ£ŸéŸÜŸíÿ™ŸèŸÖŸí ŸÑŸêÿ®Ÿéÿßÿ≥Ÿå ŸÑŸéŸáŸèŸÜŸéŸë",
                translation: "They are clothing for you and you are clothing for them.",
                context: "This verse beautifully describes the relationship between spouses - they are like clothing that protects, covers, and beautifies each other. In a healthy family, each member supports and complements the others, creating a harmonious unit where love, respect, and understanding flourish.",
                topic: "Family Relations",
                source: "Family & Daily Life",
                category: "Marriage",
                keywords: ["family", "marriage", "spouses", "relationship", "love", "protection", "unity", "harmony", "support", "understanding"]
            },
            {
                reference: "Family Unity - Al-Rum 30:21",
                arabic: "ŸàŸéŸÖŸêŸÜŸí ÿ¢ŸäŸéÿßÿ™ŸêŸáŸê ÿ£ŸéŸÜŸí ÿÆŸéŸÑŸéŸÇŸé ŸÑŸéŸÉŸèŸÖŸí ŸÖŸêŸÜŸí ÿ£ŸéŸÜŸíŸÅŸèÿ≥ŸêŸÉŸèŸÖŸí ÿ£Ÿéÿ≤ŸíŸàŸéÿßÿ¨Ÿãÿß ŸÑŸêÿ™Ÿéÿ≥ŸíŸÉŸèŸÜŸèŸàÿß ÿ•ŸêŸÑŸéŸäŸíŸáŸéÿß ŸàŸéÿ¨ŸéÿπŸéŸÑŸé ÿ®ŸéŸäŸíŸÜŸéŸÉŸèŸÖŸí ŸÖŸéŸàŸéÿØŸéŸëÿ©Ÿã ŸàŸéÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿã",
                translation: "And of His signs is that He created for you from yourselves mates that you may find tranquility in them; and He placed between you affection and mercy.",
                context: "Allah created spouses to bring tranquility, affection, and mercy to our lives. This is the foundation of a healthy family. When family members treat each other with love and compassion, they create a peaceful home environment that nurtures spiritual growth and emotional well-being.",
                topic: "Family Unity",
                source: "Family & Daily Life",
                category: "Marriage",
                keywords: ["family", "marriage", "tranquility", "affection", "mercy", "spouses", "love", "peace", "home", "spiritual growth", "emotional well-being"]
            },
            {
                reference: "Parent-Child Relations - Al-Isra 17:23-24",
                arabic: "ŸàŸéŸÇŸéÿ∂ŸéŸâ ÿ±Ÿéÿ®ŸèŸëŸÉŸé ÿ£ŸéŸÑŸéŸëÿß ÿ™ŸéÿπŸíÿ®ŸèÿØŸèŸàÿß ÿ•ŸêŸÑŸéŸëÿß ÿ•ŸêŸäŸéŸëÿßŸáŸè ŸàŸéÿ®ŸêÿßŸÑŸíŸàŸéÿßŸÑŸêÿØŸéŸäŸíŸÜŸê ÿ•Ÿêÿ≠Ÿíÿ≥ŸéÿßŸÜŸãÿß",
                translation: "And your Lord has decreed that you not worship except Him, and to parents, good treatment.",
                context: "Islam emphasizes treating parents with kindness, respect, and care. This includes speaking gently to them, helping them in their daily needs, and never showing impatience or disrespect. The Prophet (PBUH) said that serving parents is one of the most beloved acts to Allah.",
                topic: "Parent-Child Relations",
                source: "Family & Daily Life",
                category: "Family",
                keywords: ["parents", "children", "respect", "kindness", "care", "help", "patience", "service", "allah", "prophet", "family"]
            },
            {
                reference: "Daily Life - Al-Baqarah 2:168",
                arabic: "ŸäŸéÿß ÿ£ŸéŸäŸèŸëŸáŸéÿß ÿßŸÑŸÜŸéŸëÿßÿ≥Ÿè ŸÉŸèŸÑŸèŸàÿß ŸÖŸêŸÖŸéŸëÿß ŸÅŸêŸä ÿßŸÑŸíÿ£Ÿéÿ±Ÿíÿ∂Ÿê ÿ≠ŸéŸÑŸéÿßŸÑŸãÿß ÿ∑ŸéŸäŸêŸëÿ®Ÿãÿß",
                translation: "O mankind, eat from whatever is on earth [that is] lawful and good.",
                context: "Islam teaches us to consume only what is halal (permissible) and tayyib (good/wholesome) in our daily lives. This applies to food, entertainment, relationships, and all aspects of life. Making halal choices ensures our actions are blessed and brings us closer to Allah.",
                topic: "Daily Life",
                source: "Family & Daily Life",
                category: "Daily Living",
                keywords: ["daily life", "food", "halal", "tayyib", "permissible", "wholesome", "consumption", "entertainment", "relationships", "blessed", "allah"]
            },
            {
                reference: "Moral Boundaries - Al-Isra 17:32",
                arabic: "ŸàŸéŸÑŸéÿß ÿ™ŸéŸÇŸíÿ±Ÿéÿ®ŸèŸàÿß ÿßŸÑÿ≤ŸêŸëŸÜŸéÿß €ñ ÿ•ŸêŸÜŸéŸëŸáŸè ŸÉŸéÿßŸÜŸé ŸÅŸéÿßÿ≠Ÿêÿ¥Ÿéÿ©Ÿã ŸàŸéÿ≥Ÿéÿßÿ°Ÿé ÿ≥Ÿéÿ®ŸêŸäŸÑŸãÿß",
                translation: "And do not approach unlawful sexual intercourse. Indeed, it is an immorality and an evil way.",
                context: "Islam provides clear guidance on maintaining moral boundaries in daily life and relationships. This includes proper conduct between men and women, avoiding inappropriate interactions, and preserving the sanctity of family relationships. These boundaries protect society and maintain moral standards.",
                topic: "Moral Boundaries",
                source: "Family & Daily Life",
                category: "Daily Living",
                keywords: ["moral boundaries", "relationships", "conduct", "men", "women", "interactions", "sanctity", "family", "society", "standards", "protection"]
            }
        ];
        
        // AI Search System
        class IslamicAI {
            constructor() {
                this.databases = [
                    islamicDatabase,
                    hadithDatabase,
                    fiqhDatabase,
                    newMuslimDatabase,
                    whatIsIslamDatabase,
                    fivePillarsDatabase,
                    sunnahDatabase,
                    familyDailyLifeDatabase
                ];
            }
            
            searchWithSemantics(query, source = 'all') {
                const queryLower = query.toLowerCase();
                let results = [];
                
                // Determine which databases to search based on source
                let searchableDatabases = this.databases;
                if (source !== 'all') {
                    switch(source) {
                        case 'quran':
                            searchableDatabases = [islamicDatabase];
                            break;
                        case 'hadith':
                            searchableDatabases = [hadithDatabase];
                            break;
                        case 'fiqh':
                            searchableDatabases = [fiqhDatabase];
                            break;
                        case 'new-muslim':
                            searchableDatabases = [newMuslimDatabase];
                            break;
                        case 'what-is-islam':
                            searchableDatabases = [whatIsIslamDatabase];
                            break;
                        case 'five-pillars':
                            searchableDatabases = [fivePillarsDatabase];
                            break;
                        case 'sunnah':
                            searchableDatabases = [sunnahDatabase];
                            break;
                        case 'family-daily-life':
                            searchableDatabases = [familyDailyLifeDatabase];
                            break;
                    }
                }
                
                // Search through databases
                searchableDatabases.forEach(database => {
                    database.forEach(item => {
                        const relevance = this.calculateRelevance(queryLower, item);
                        if (relevance > 0) {
                            results.push({ ...item, relevance });
                        }
                    });
                });
                
                // Sort by relevance and return top results
                return results.sort((a, b) => b.relevance - a.relevance).slice(0, 10);
            }
            
            calculateRelevance(query, item) {
                let score = 0;
                const queryWords = query.split(' ');
                
                // Check keywords
                if (item.keywords) {
                    item.keywords.forEach(keyword => {
                        if (query.includes(keyword.toLowerCase())) {
                            score += 10;
                        }
                    });
                }
                
                // Check topic
                if (item.topic && query.includes(item.topic.toLowerCase())) {
                    score += 8;
                }
                
                // Check category
                if (item.category && query.includes(item.category.toLowerCase())) {
                    score += 6;
                }
                
                // Check translation
                if (item.translation && queryWords.some(word => 
                    item.translation.toLowerCase().includes(word))) {
                    score += 4;
                }
                
                // Check context
                if (item.context && queryWords.some(word => 
                    item.context.toLowerCase().includes(word))) {
                    score += 3;
                }
                
                return score;
            }
        }
        
        const islamicAI = new IslamicAI();
        
        function setSource(source) {
            currentSource = source;
            document.querySelectorAll('.source-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                alert('Please enter a search query');
                return;
            }
            
            // Show results section with loading
            document.getElementById('resultsSection').classList.add('show');
            document.getElementById('resultsCount').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Searching for: "${query}"</div>
                </div>
            `;
            
            // Call the Python backend AI
            fetch("http://localhost:8080/chat", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ message: query })
            })
            .then(response => response.json())
            .then(data => {
                // Display AI response
                document.getElementById('resultsCount').innerHTML = `AI Response for: "${query}"`;
                document.getElementById('verseResults').innerHTML = `
                    <div class="ai-summary">
                        <h3>AI Assistant Response</h3>
                        <div class="ai-response" style="white-space: pre-line; line-height: 1.8; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                            ${data.response}
                        </div>
                        <div class="suggestions">
                            <h4>Try asking about:</h4>
                            <div class="suggestion-buttons">
                                <button class="suggestion-btn" onclick="searchSuggestion('mercy')">Mercy</button>
                                <button class="suggestion-btn" onclick="searchSuggestion('patience')">Patience</button>
                                <button class="suggestion-btn" onclick="searchSuggestion('family')">Family</button>
                                <button class="suggestion-btn" onclick="searchSuggestion('prayer')">Prayer</button>
                            </div>
                        </div>
                    </div>
                `;
            })
            .catch(error => {
                console.error("Backend Error:", error);
                // Show user-friendly error message
                document.getElementById('resultsCount').innerHTML = `‚ùå Backend Error: ${error.message}`;
                document.getElementById('verseResults').innerHTML = `
                    <div class="no-results">
                        <h3>Backend Connection Failed</h3>
                        <p>Error: ${error.message}</p>
                        <p>Please check if the Python backend is running on port 8080</p>
                        <button onclick="performSearch()" class="action-btn">Try Again</button>
                        <button onclick="useLocalSearch('${query}')" class="action-btn">Use Local Search</button>
                    </div>
                `;
            });
        }
        
        function displayResults(query, results) {
            if (results.length === 0) {
                document.getElementById('resultsCount').innerHTML = `No results found for "${query}"`;
                document.getElementById('verseResults').innerHTML = `
                    <div class="no-results">
                        <h3>No Results Found</h3>
                        <p>Try searching for different keywords or browse our categories:</p>
                        <div class="suggestion-buttons">
                            <button class="suggestion-btn" onclick="searchSuggestion('prayer')">Prayer</button>
                            <button class="suggestion-btn" onclick="searchSuggestion('family')">Family</button>
                            <button class="suggestion-btn" onclick="searchSuggestion('inheritance')">Inheritance</button>
                            <button class="suggestion-btn" onclick="searchSuggestion('daily life')">Daily Life</button>
                        </div>
                    </div>
                `;
                return;
            }
            
            document.getElementById('resultsCount').innerHTML = `Found ${results.length} results for "${query}"`;
            
            // Generate AI summary
            const summary = generateAISummary(query, results);
            
            // Display results
            let resultsHTML = summary;
            
            results.forEach(result => {
                resultsHTML += `
                    <div class="verse-item">
                        <div class="verse-header">
                            <div class="verse-reference">${result.reference}</div>
                            <div class="verse-source">${result.source}</div>
                            <div class="verse-topic">${result.topic}</div>
                        </div>
                        ${result.arabic ? `<div class="arabic-text">${result.arabic}</div>` : ''}
                        <div class="translation">${result.translation}</div>
                        <div class="context">${result.context}</div>
                        <div class="verse-actions">
                            <button class="action-btn" onclick="copyToClipboard(this)">Copy</button>
                            <button class="action-btn" onclick="shareVerse(this)">Share</button>
                            <button class="action-btn" onclick="addToFavorites(this)">Favorite</button>
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('verseResults').innerHTML = resultsHTML;
        }
        
        function generateAISummary(query, results) {
            const topics = [...new Set(results.map(r => r.topic))];
            const sources = [...new Set(results.map(r => r.source))];
            
            return `
                <div class="ai-summary">
                    <h3>AI Assistant Summary</h3>
                    <p>I found ${results.length} relevant results about "${query}". The search covered ${sources.join(', ')} sources and found information about ${topics.join(', ')}.</p>
                    <div class="suggestions">
                        <h4>Suggested Related Topics:</h4>
                        <div class="suggestion-buttons">
                            ${topics.slice(0, 4).map(topic => 
                                `<button class="suggestion-btn" onclick="searchSuggestion('${topic.toLowerCase()}')">${topic}</button>`
                            ).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function searchSuggestion(topic) {
            document.getElementById('searchInput').value = topic;
            performSearch();
        }
        
        function copyToClipboard(button) {
            const verseItem = button.closest('.verse-item');
            const text = verseItem.querySelector('.translation').textContent;
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = 'Copied!';
                setTimeout(() => button.textContent = 'Copy', 2000);
            });
        }
        
        function shareVerse(button) {
            const verseItem = button.closest('.verse-item');
            const text = verseItem.querySelector('.translation').textContent;
            const reference = verseItem.querySelector('.verse-reference').textContent;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Islamic Wisdom',
                    text: `${reference}: ${text}`
                });
            } else {
                alert('Verse copied to clipboard!');
                navigator.clipboard.writeText(`${reference}: ${text}`);
            }
        }
        
        function addToFavorites(button) {
            button.textContent = 'Added!';
            setTimeout(() => button.textContent = 'Favorite', 2000);
        }
        
        function handleSearch(event) {
            if (event.key === "Enter") {
                performSearch();
            }
        }
        
        function goBack() {
            window.location.href = 'index.html';
        }
        
        function useLocalSearch(query) {
            // Fallback to local search if backend fails
            document.getElementById('resultsCount').innerHTML = `Using Local Search for: "${query}"`;
            const results = islamicAI.searchWithSemantics(query, currentSource);
            displayResults(query, results);
        }
        
        function handleChatKeyPress(event) {
            if (event.key === "Enter") {
                sendChatMessage();
            }
        }
        
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message to chat
            addChatMessage(message, true);
            input.value = '';
            
            // Call AI backend
            fetch("http://localhost:8080/chat", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ message: message })
            })
            .then(response => {
                return response.json();
            })
            .then(data => {
                // Add AI response to chat
                addChatMessage(data.response, false);
            })
            .catch(error => {
                console.error("Backend Error:", error);
                addChatMessage("I apologize, but I encountered an error. Please try again.", false);
            });
        }
        
        function addChatMessage(content, isUser) {
            const chatMessages = document.getElementById('chatMessages');
            
            if (!chatMessages) {
                console.error('chatMessages element not found!');
                return;
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
            
            if (isUser) {
                messageDiv.innerHTML = `<div class="message-content">${content}</div>`;
            } else {
                // Format AI response with line breaks
                const formattedContent = content.replace(/\n/g, '<br>');
                messageDiv.innerHTML = `<div class="message-content">${formattedContent}</div>`;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function testDeenBot() {
            // Test the chat interface directly
            const testMessage = "Hello DeenBot! This is a test message.";
            
            // Add a test user message
            addChatMessage(testMessage, true);
            
            // Wait a moment, then add a test bot response
            setTimeout(() => {
                const testResponse = "Assalamu alaikum! I received your test message. DeenBot is working!";
                addChatMessage(testResponse, false);
                
                // Now test the backend
                fetch("http://localhost:8080/chat", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ message: "test" })
                })
                .then(response => response.json())
                .then(data => {
                    addChatMessage("Backend test successful! DeenBot is fully operational.", false);
                })
                .catch(error => {
                    console.error('Backend test failed:', error);
                    addChatMessage("‚ùå Backend test failed. Please check if the Python server is running on port 8080.", false);
                });
            }, 1000);
        }
        
        function testChatbot() {
            // Test the chatbot functionality with backend
            document.getElementById('resultsSection').classList.add('show');
            document.getElementById('resultsCount').innerHTML = 'Testing chatbot with AI backend...';
            
            // Test search with backend
            const testQuery = 'family';
            fetch("http://localhost:8080/chat", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({ message: testQuery })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('resultsCount').innerHTML = `Test successful! AI backend is working for "${testQuery}"`;
                document.getElementById('verseResults').innerHTML = `
                    <div class="ai-summary">
                        <h3>AI Backend Test Response</h3>
                        <div class="ai-response" style="white-space: pre-line; line-height: 1.8; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin: 20px 0;">
                            ${data.response}
                        </div>
                        <div style="margin-top: 20px; padding: 15px; background: #28a745; color: white; border-radius: 10px; text-align: center;">
                            üéâ DeenBot is working perfectly! You can now ask any Islamic question.
                        </div>
                    </div>
                `;
            })
            .catch(error => {
                console.error("Backend test error:", error);
                document.getElementById('resultsCount').innerHTML = '‚ùå Test failed: Backend not accessible';
                document.getElementById('verseResults').innerHTML = `
                    <div class="no-results">
                        <h3>Backend Test Failed</h3>
                        <p>Error: ${error.message}</p>
                        <p>Please make sure the Python backend is running on port 8080</p>
                        <button onclick="testChatbot()" class="action-btn">Try Again</button>
                    </div>
                `;
            });
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Show a welcome message
            document.getElementById('resultsSection').classList.add('show');
            document.getElementById('resultsCount').innerHTML = 'Welcome to DeenBot! Ask any question about Islam, Quran, Hadith, Fiqh, and more.';
            document.getElementById('verseResults').innerHTML = `
                <div class="suggestion-buttons">
                    <button class="suggestion-btn" onclick="searchSuggestion('family')">Family relationships</button>
                    <button class="suggestion-btn" onclick="searchSuggestion('prayer')">Prayer guidance</button>
                    <button class="suggestion-btn" onclick="searchSuggestion('inheritance')">Inheritance laws</button>
                    <button class="suggestion-btn" onclick="searchSuggestion('daily life')">Daily life guidance</button>
                </div>
            `;
        });
    </script>
</body>
</html>
