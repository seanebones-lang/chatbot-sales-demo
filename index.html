<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Islamic Knowledge - AI-Powered Quran & Hadith Assistant</title>
    <meta name="description" content="Advanced Islamic knowledge system with AI-powered responses, comprehensive search, and interactive learning. Get accurate answers to any Islamic question instantly.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a1f2e 100%);
            color: #e0e0e0;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 0;
            background: linear-gradient(135deg, rgba(30, 144, 255, 0.1) 0%, rgba(0, 77, 97, 0.1) 100%);
            border-radius: 20px;
            border: 1px solid rgba(30, 144, 255, 0.3);
        }

        .header h1 {
            font-size: 3.5rem;
            color: #1E90FF;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(30, 144, 255, 0.5);
        }

        .header .subtitle {
            font-size: 1.3rem;
            color: #87CEEB;
            margin-bottom: 20px;
        }

        .header .description {
            font-size: 1.1rem;
            color: #b0c4de;
            max-width: 800px;
            margin: 0 auto;
        }

        .ai-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .search-section {
            background: rgba(24, 24, 24, 0.9);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(68, 68, 68, 0.5);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        .search-input {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 18px 20px;
            border: 2px solid rgba(68, 68, 68, 0.5);
            border-radius: 15px;
            background: rgba(24, 24, 24, 0.8);
            color: #E0E0E0;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #1E90FF;
            box-shadow: 0 0 20px rgba(30, 144, 255, 0.3);
            background: rgba(24, 24, 24, 0.95);
        }

        button {
            padding: 18px 30px;
            background: linear-gradient(135deg, #1E90FF 0%, #004D61 100%);
            color: #FFFFFF;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(30, 144, 255, 0.3);
        }

        .source-toggle {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .source-btn {
            padding: 15px 30px;
            background: rgba(68, 68, 68, 0.5);
            border: 2px solid rgba(68, 68, 68, 0.8);
            border-radius: 15px;
            color: #b0c4de;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .source-btn.active {
            background: linear-gradient(135deg, #1E90FF 0%, #004D61 100%);
            color: white;
            border-color: #1E90FF;
            box-shadow: 0 5px 20px rgba(30, 144, 255, 0.3);
        }

        .source-btn:hover {
            transform: translateY(-2px);
        }

        .ai-summary {
            background: rgba(18, 18, 18, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #FFD700;
        }

        .ai-summary h3 {
            color: #FFD700;
            margin-bottom: 10px;
            font-size: 1.3rem;
        }

        .ai-summary p {
            color: #E0E0E0;
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .ai-summary .suggestions {
            margin-top: 15px;
        }

        .ai-summary .suggestions h4 {
            color: #87CEEB;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .suggestion-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .suggestion-btn {
            padding: 8px 15px;
            background: rgba(30, 144, 255, 0.2);
            border: 1px solid rgba(30, 144, 255, 0.5);
            border-radius: 10px;
            color: #87CEEB;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .suggestion-btn:hover {
            background: rgba(30, 144, 255, 0.3);
            border-color: #1E90FF;
        }

        .results-section {
            display: none;
            background: rgba(24, 24, 24, 0.9);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(68, 68, 68, 0.5);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        .results-count {
            color: #87CEEB;
            font-size: 1.2rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .verse-item {
            background: rgba(18, 18, 18, 0.8);
            border: 1px solid rgba(68, 68, 68, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .verse-item:hover {
            border-color: #1E90FF;
            box-shadow: 0 10px 25px rgba(30, 144, 255, 0.2);
        }

        .verse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .verse-reference {
            color: #1E90FF;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .verse-source {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .verse-topic {
            background: rgba(30, 144, 255, 0.2);
            color: #1E90FF;
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .relevance-score {
            color: #FFD700;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .matched-terms {
            color: #87CEEB;
            font-size: 0.8rem;
            margin-top: 10px;
        }

        .verse-text {
            margin-bottom: 15px;
        }

        .verse-arabic {
            color: #FFD700;
            font-size: 1.3rem;
            text-align: right;
            margin-bottom: 10px;
            line-height: 2;
        }

        .verse-translation {
            color: #E0E0E0;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .verse-context h4 {
            color: #87CEEB;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .verse-context p {
            color: #b0c4de;
            line-height: 1.6;
        }

        .hadith-authentication {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .hadith-authentication .level {
            color: #FFD700;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .hadith-authentication .narrator {
            color: #FFD700;
            font-size: 0.9rem;
        }

        .verse-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 15px;
            background: rgba(30, 144, 255, 0.2);
            border: 1px solid rgba(30, 144, 255, 0.5);
            border-radius: 10px;
            color: #87CEEB;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .action-btn:hover {
            background: rgba(30, 144, 255, 0.3);
            border-color: #1E90FF;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .notification.show {
            opacity: 1;
        }

        .notification.success {
            background-color: #4CAF50;
        }

        .notification.error {
            background-color: #F44336;
        }

        .notification.info {
            background-color: #2196F3;
        }

        .no-results {
            text-align: center;
            padding: 30px;
        }

        .no-results h3 {
            color: #FFD700;
            margin-bottom: 15px;
        }

        .no-results ul {
            text-align: left;
            max-width: 400px;
            margin: 20px auto;
            color: #87CEEB;
        }

        .no-results li {
            margin: 10px 0;
        }

        .topic-suggestions {
            background: rgba(18, 18, 18, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border-left: 5px solid #87CEEB;
        }

        .topic-suggestions h4 {
            color: #87CEEB;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .auto-verse {
            background: linear-gradient(135deg, rgba(30, 144, 255, 0.1) 0%, rgba(0, 77, 97, 0.1) 100%);
            border: 2px solid rgba(30, 144, 255, 0.3);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        .auto-verse h3 {
            color: #1E90FF;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .wisdom-text {
            color: #E0E0E0;
            font-size: 1.2rem;
            font-style: italic;
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .wisdom-source {
            color: #87CEEB;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .wisdom-category {
            color: #FFD700;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .footer {
            text-align: center;
            margin-top: 50px;
            padding: 30px;
            color: #87CEEB;
            border-top: 1px solid rgba(68, 68, 68, 0.3);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .container {
                padding: 15px;
            }
            
            .search-input {
                flex-direction: column;
            }
            
            .source-toggle {
                flex-direction: column;
                align-items: center;
            }
            
            .verse-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI-Powered Islamic Knowledge</h1>
            <div class="subtitle">Advanced Quran & Hadith Assistant</div>
            <div class="description">
                Get intelligent, contextual responses to any Islamic question. Our AI system understands your intent and provides the most relevant Islamic knowledge from authentic sources.
            </div>
            <div class="ai-badge">üöÄ AI-Enhanced Search & Responses</div>
        </div>

        <div class="search-section">
            <div class="search-input">
                <input type="text" id="searchInput" placeholder="Ask any Islamic question (e.g., 'What does Islam say about mercy?', 'How to pray?', 'Why is knowledge important?')" onkeypress="handleSearch(event)">
                <button onclick="performSearch()">üîç Search</button>
            </div>
            
            <div class="source-toggle">
                <button class="source-btn active" onclick="setSource('both')">üìö All Sources</button>
                <button class="source-btn" onclick="setSource('quran')">üìñ Quran Only</button>
                <button class="source-btn" onclick="setSource('hadith')">üìú Hadith Only</button>
            </div>
        </div>

        <div class="auto-verse" id="autoWisdom">
            <h3>üí° Daily Islamic Wisdom</h3>
            <div class="wisdom-text">Loading wisdom...</div>
            <div class="wisdom-source">- Loading...</div>
            <div class="wisdom-category">Islamic Wisdom</div>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="results-count" id="resultsCount"></div>
            <div id="verseResults"></div>
        </div>
    </div>

    <script>
        // Enhanced Islamic Knowledge Database with AI-powered responses
        const islamicDatabase = {
            // Core Islamic Concepts
            tawheed: [
                {
                    reference: "Al-Ikhlas 112:1-4",
                    arabic: "ŸÇŸèŸÑŸí ŸáŸèŸàŸé ÿßŸÑŸÑŸéŸëŸáŸè ÿ£Ÿéÿ≠ŸéÿØŸå Ô¥øŸ°Ô¥æ ÿßŸÑŸÑŸéŸëŸáŸè ÿßŸÑÿµŸéŸëŸÖŸéÿØŸè Ô¥øŸ¢Ô¥æ ŸÑŸéŸÖŸí ŸäŸéŸÑŸêÿØŸí ŸàŸéŸÑŸéŸÖŸí ŸäŸèŸàŸÑŸéÿØŸí Ô¥øŸ£Ô¥æ ŸàŸéŸÑŸéŸÖŸí ŸäŸéŸÉŸèŸÜ ŸÑŸéŸëŸáŸè ŸÉŸèŸÅŸèŸàŸãÿß ÿ£Ÿéÿ≠ŸéÿØŸå Ô¥øŸ§Ô¥æ",
                    translation: "Say, 'He is Allah, [who is] One, Allah, the Eternal Refuge. He neither begets nor is born, nor is there to Him any equivalent.'",
                    context: "The fundamental Islamic belief in the oneness of Allah (Tawheed) - the cornerstone of Islamic faith. This verse establishes the pure monotheistic belief that Allah is unique, eternal, and has no partners or equals.",
                    topic: "Tawheed",
                    source: "Quran",
                    keywords: ["oneness", "unity", "monotheism", "allah", "god", "divine", "eternal", "refuge", "unique", "no partners"]
                },
                {
                    reference: "Sahih Bukhari 1:1",
                    arabic: "ÿ•ŸêŸÜŸéŸëŸÖŸéÿß ÿßŸÑÿ£ŸéÿπŸíŸÖŸéÿßŸÑŸè ÿ®ŸêÿßŸÑŸÜŸêŸëŸäŸéŸëÿßÿ™Ÿê",
                    translation: "Actions are judged by intentions, and every person will be rewarded according to what they intended.",
                    context: "Prophet Muhammad (Ô∑∫) emphasized that sincere intention (niyyah) is essential for all actions to be accepted by Allah. This hadith teaches that the value of any deed lies in the intention behind it.",
                    topic: "Tawheed",
                    source: "Hadith",
                    authentication: "Sahih",
                    narrator: "Narrated by Umar ibn Al-Khattab",
                    keywords: ["intention", "niyyah", "sincerity", "actions", "rewards", "acceptance", "value", "deeds"]
                }
            ],
            
            // Five Pillars of Islam
            salah: [
                {
                    reference: "Al-Baqarah 2:43",
                    arabic: "ŸàŸéÿ£ŸéŸÇŸêŸäŸÖŸèŸàÿß ÿßŸÑÿµŸéŸëŸÑŸéÿßÿ©Ÿé ŸàŸéÿ¢ÿ™ŸèŸàÿß ÿßŸÑÿ≤ŸéŸëŸÉŸéÿßÿ©Ÿé",
                    translation: "And establish prayer and give zakah",
                    context: "Prayer (Salah) as a fundamental pillar of Islamic practice and spiritual discipline. This verse commands believers to establish regular prayer as a means of maintaining connection with Allah and spiritual discipline.",
                    topic: "Salah",
                    source: "Quran",
                    keywords: ["prayer", "establish", "worship", "discipline", "spiritual", "pillar", "obligation", "connection", "regular"]
                },
                {
                    reference: "Sahih Bukhari 2:8",
                    arabic: "ÿßŸÑÿµŸéŸëŸÑŸéÿßÿ©Ÿè ÿπŸêŸÖŸéÿßÿØŸè ÿßŸÑÿØŸêŸëŸäŸÜŸê",
                    translation: "Prayer is the pillar of religion",
                    context: "Prophet Muhammad (Ô∑∫) emphasized that prayer is the foundation of Islamic faith and practice. Without prayer, the structure of faith cannot stand, making it the most important act of worship.",
                    topic: "Salah",
                    source: "Hadith",
                    authentication: "Sahih",
                    narrator: "Narrated by Abu Hurairah",
                    keywords: ["pillar", "foundation", "religion", "faith", "practice", "essential", "structure", "worship"]
                }
            ],
            
            // Character and Ethics
            mercy: [
                {
                    reference: "Al-Fatiha 1:1",
                    arabic: "ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸéŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸÖŸê",
                    translation: "In the name of Allah, the Entirely Merciful, the Especially Merciful",
                    context: "Allah's mercy encompasses everything and is the foundation of Islamic teachings. This opening verse of the Quran establishes that Allah's mercy is all-encompassing and should be reflected in how believers treat others.",
                    topic: "Mercy",
                    source: "Quran",
                    keywords: ["mercy", "compassion", "blessing", "beginning", "foundation", "allah", "bismillah", "encompassing", "treat others"]
                },
                {
                    reference: "Sahih Muslim 4:2024",
                    arabic: "ŸÖŸéŸÜŸí ŸÑŸéÿß ŸäŸéÿ±Ÿíÿ≠ŸéŸÖŸè ŸÑŸéÿß ŸäŸèÿ±Ÿíÿ≠ŸéŸÖŸè",
                    translation: "Whoever does not show mercy will not be shown mercy",
                    context: "Prophet Muhammad (Ô∑∫) taught that showing kindness and mercy to others is essential for receiving divine mercy. This hadith establishes the principle of reciprocity in mercy and compassion.",
                    topic: "Mercy",
                    source: "Hadith",
                    authentication: "Sahih",
                    narrator: "Narrated by Jarir ibn Abdullah",
                    keywords: ["show mercy", "kindness", "essential", "divine mercy", "reciprocity", "teaching", "compassion"]
                }
            ],
            
            kindness: [
                {
                    reference: "Al-Baqarah 2:195",
                    arabic: "ŸàŸéÿ£Ÿéÿ≠Ÿíÿ≥ŸêŸÜŸèŸàÿß €õ ÿ•ŸêŸÜŸéŸë ÿßŸÑŸÑŸéŸëŸáŸé ŸäŸèÿ≠Ÿêÿ®ŸèŸë ÿßŸÑŸíŸÖŸèÿ≠Ÿíÿ≥ŸêŸÜŸêŸäŸÜŸé",
                    translation: "And do good; indeed, Allah loves the doers of good",
                    context: "Allah commands believers to be kind and do good deeds, as He loves those who excel in goodness. This verse encourages excellence in all actions and treating others with kindness and generosity.",
                    topic: "Kindness",
                    source: "Quran",
                    keywords: ["good deeds", "excellence", "allah loves", "command", "believers", "goodness", "kindness", "generosity", "actions"]
                }
            ],
            
            patience: [
                {
                    reference: "Al-Baqarah 2:153",
                    arabic: "ŸäŸéÿß ÿ£ŸéŸäŸèŸëŸáŸéÿß ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ÿ¢ŸÖŸéŸÜŸèŸàÿß ÿßÿ≥Ÿíÿ™ŸéÿπŸêŸäŸÜŸèŸàÿß ÿ®ŸêÿßŸÑÿµŸéŸëÿ®Ÿíÿ±Ÿê ŸàŸéÿßŸÑÿµŸéŸëŸÑŸéÿßÿ©Ÿê",
                    translation: "O you who have believed, seek help through patience and prayer",
                    context: "Allah teaches believers to seek strength through patience and prayer during difficult times. This verse provides the formula for overcoming challenges: patience in adversity and prayer for divine assistance.",
                    topic: "Patience",
                    source: "Quran",
                    keywords: ["seek help", "strength", "difficult times", "believers", "prayer", "patience", "support", "challenges", "adversity"]
                }
            ],
            
            // Knowledge and Learning
            knowledge: [
                {
                    reference: "Al-Zumar 39:9",
                    arabic: "ŸÇŸèŸÑŸí ŸáŸéŸÑŸí ŸäŸéÿ≥Ÿíÿ™ŸéŸàŸêŸä ÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ŸäŸéÿπŸíŸÑŸéŸÖŸèŸàŸÜŸé ŸàŸéÿßŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ŸÑŸéÿß ŸäŸéÿπŸíŸÑŸéŸÖŸèŸàŸÜŸé",
                    translation: "Say, 'Are those who know equal to those who do not know?'",
                    context: "Allah emphasizes the importance of seeking knowledge and education. This rhetorical question highlights the fundamental difference between those who pursue knowledge and those who remain ignorant.",
                    topic: "Knowledge",
                    source: "Quran",
                    keywords: ["knowledge", "equal", "importance", "education", "seeking", "learn", "ignorance", "pursue", "difference"]
                }
            ],
            
            // Family and Relationships
            family: [
                {
                    reference: "Al-Isra 17:23",
                    arabic: "ŸàŸéŸÇŸéÿ∂ŸéŸâŸ∞ ÿ±Ÿéÿ®ŸèŸëŸÉŸé ÿ£ŸéŸÑŸéŸëÿß ÿ™ŸéÿπŸíÿ®ŸèÿØŸèŸàÿß ÿ•ŸêŸÑŸéŸëÿß ÿ•ŸêŸäŸéŸëÿßŸáŸè ŸàŸéÿ®ŸêÿßŸÑŸíŸàŸéÿßŸÑŸêÿØŸéŸäŸíŸÜŸê ÿ•Ÿêÿ≠Ÿíÿ≥ŸéÿßŸÜŸãÿß",
                    translation: "And your Lord has decreed that you not worship except Him, and to parents, good treatment",
                    context: "Allah commands good treatment of parents as a fundamental duty alongside worship. This verse establishes that honoring parents is second only to worshipping Allah in importance.",
                    topic: "Family",
                    source: "Quran",
                    keywords: ["parents", "good treatment", "duty", "worship", "command", "fundamental", "decreed", "honor", "importance"]
                }
            ]
        };

        // AI-powered response generation system
        class IslamicAI {
            constructor() {
                this.context = {};
                this.conversationHistory = [];
            }

            // Enhanced search with semantic matching
            searchWithSemantics(query, source = 'both') {
                const results = [];
                const searchTerms = this.tokenizeQuery(query);
                const queryIntent = this.analyzeIntent(query);

                Object.keys(islamicDatabase).forEach(topic => {
                    islamicDatabase[topic].forEach(item => {
                        if (source === 'both' || item.source.toLowerCase() === source.toLowerCase()) {
                            const relevanceScore = this.calculateRelevance(item, searchTerms, queryIntent);
                            if (relevanceScore > 0.3) { // Threshold for relevance
                                results.push({
                                    ...item,
                                    relevanceScore,
                                    matchedTerms: this.findMatchedTerms(item, searchTerms)
                                });
                            }
                        }
                    });
                });

                // Sort by relevance score
                return results.sort((a, b) => b.relevanceScore - a.relevanceScore);
            }

            // Tokenize and clean query
            tokenizeQuery(query) {
                return query.toLowerCase()
                    .replace(/[^\w\s]/g, ' ')
                    .split(/\s+/)
                    .filter(word => word.length > 2)
                    .map(word => this.stemWord(word));
            }

            // Basic word stemming for better matching
            stemWord(word) {
                // Remove common suffixes
                const suffixes = ['ing', 'ed', 'er', 'est', 'ly', 's', 'es'];
                for (let suffix of suffixes) {
                    if (word.endsWith(suffix) && word.length > suffix.length + 2) {
                        word = word.slice(0, -suffix.length);
                        break;
                    }
                }
                return word;
            }

            // Analyze user intent
            analyzeIntent(query) {
                const queryLower = query.toLowerCase();
                
                if (queryLower.includes('what') || queryLower.includes('explain') || queryLower.includes('tell me')) {
                    return 'explanation';
                } else if (queryLower.includes('how') || queryLower.includes('method') || queryLower.includes('way')) {
                    return 'method';
                } else if (queryLower.includes('why') || queryLower.includes('reason') || queryLower.includes('purpose')) {
                    return 'reason';
                } else {
                    return 'general';
                }
            }

            // Calculate relevance score
            calculateRelevance(item, searchTerms, intent) {
                let score = 0;
                const itemText = `${item.translation} ${item.context} ${item.topic}`.toLowerCase();
                
                // Exact keyword matches
                searchTerms.forEach(term => {
                    if (itemText.includes(term)) {
                        score += 0.4;
                    }
                    // Check keywords array if it exists
                    if (item.keywords && item.keywords.some(keyword => keyword.includes(term))) {
                        score += 0.3;
                    }
                });

                // Intent matching
                if (intent === 'explanation' && item.context.length > 50) {
                    score += 0.2;
                }

                // Source preference
                if (item.source === 'Quran') {
                    score += 0.1;
                }

                return Math.min(score, 1.0);
            }

            // Find which terms matched
            findMatchedTerms(item, searchTerms) {
                const matched = [];
                const itemText = `${item.translation} ${item.context} ${item.topic}`.toLowerCase();
                
                searchTerms.forEach(term => {
                    if (itemText.includes(term)) {
                        matched.push(term);
                    }
                });
                
                return matched;
            }

            // Generate contextual response
            generateResponse(query, results) {
                if (results.length === 0) {
                    return {
                        text: "I couldn't find specific information about that topic. Could you please rephrase your question or ask about a different Islamic topic?",
                        suggestions: ["Try asking about prayer", "Ask about Quran verses", "Inquire about Hadith", "Learn about Islamic ethics"]
                    };
                }

                const topResult = results[0];
                let response = `Based on your question about "${query}", here's what I found:\n\n`;
                
                response += `**${topResult.reference}**\n`;
                if (topResult.arabic) {
                    response += `*Arabic:* ${topResult.arabic}\n\n`;
                }
                response += `*Translation:* ${topResult.translation}\n\n`;
                response += `*Context:* ${topResult.context}\n\n`;
                
                if (topResult.source === 'Hadith' && topResult.authentication) {
                    response += `*Authentication:* ${topResult.authentication}\n`;
                    if (topResult.narrator) {
                        response += `*Narrated by:* ${topResult.narrator}\n`;
                    }
                }

                return {
                    text: response,
                    suggestions: this.generateSuggestions(topResult, results),
                    relatedTopics: this.findRelatedTopics(topResult.topic)
                };
            }

            // Generate contextual suggestions
            generateSuggestions(topResult, allResults) {
                const suggestions = [];
                
                // Add topic-based suggestions
                if (topResult.topic === 'Salah') {
                    suggestions.push("Learn about prayer times", "Understand prayer benefits", "Study prayer etiquette");
                } else if (topResult.topic === 'Tawheed') {
                    suggestions.push("Learn about Allah's attributes", "Study monotheism", "Understand divine unity");
                } else if (topResult.topic === 'Mercy') {
                    suggestions.push("Learn about compassion", "Study forgiveness", "Understand kindness");
                }

                return suggestions.slice(0, 3);
            }

            // Find related topics
            findRelatedTopics(topic) {
                const related = [];
                const topicMap = {
                    'Salah': ['Prayer', 'Worship', 'Spirituality'],
                    'Tawheed': ['Monotheism', 'Faith', 'Belief'],
                    'Mercy': ['Kindness', 'Compassion', 'Forgiveness'],
                    'Knowledge': ['Learning', 'Education', 'Wisdom'],
                    'Family': ['Relationships', 'Parents', 'Children']
                };

                if (topicMap[topic]) {
                    related.push(...topicMap[topic]);
                }

                return related;
            }
        }

        // Initialize AI system
        const islamicAI = new IslamicAI();

        // Enhanced Auto-interactive wisdom with more categories
        const autoWisdom = [
            {
                reference: "Al-Baqarah 2:186",
                text: "And when My servants ask you concerning Me, indeed I am near. I respond to the invocation of the supplicant when he calls upon Me.",
                source: "Quran",
                category: "Dua & Supplication"
            },
            {
                reference: "Sahih Bukhari 1:1",
                text: "Actions are judged by intentions, and every person will be rewarded according to what they intended.",
                source: "Hadith",
                category: "Intentions & Actions"
            },
            {
                reference: "Al-Fatiha 1:5",
                text: "It is You we worship and You we ask for help.",
                source: "Quran",
                category: "Worship & Dependence"
            },
            {
                reference: "Sahih Muslim 4:2024",
                text: "Whoever does not show mercy will not be shown mercy. The merciful are shown mercy by the Most Merciful.",
                source: "Hadith",
                category: "Mercy & Compassion"
            },
            {
                reference: "Al-Isra 17:82",
                text: "And We send down of the Quran that which is healing and mercy for the believers.",
                source: "Quran",
                category: "Quran & Healing"
            }
        ];

        let currentSource = 'both';
        let autoWisdomIndex = 0;
        let autoWisdomTimer;

        // Enhanced search functions
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            const results = islamicAI.searchWithSemantics(query, currentSource);
            displayResults(results, query);
        }

        function displayResults(results, query) {
            const resultsSection = document.getElementById('resultsSection');
            const resultsCount = document.getElementById('resultsCount');
            const verseResults = document.getElementById('verseResults');

            if (results.length === 0) {
                resultsCount.textContent = `No results found for "${query}". Try rephrasing your question.`;
                resultsSection.style.display = 'block';
                verseResults.innerHTML = `
                    <div class="no-results">
                        <h3>No exact matches found</h3>
                        <p>Try these suggestions:</p>
                        <div class="suggestion-buttons">
                            <button onclick="searchByTopic('prayer')" class="suggestion-btn">Prayer</button>
                            <button onclick="searchByTopic('mercy')" class="suggestion-btn">Mercy</button>
                            <button onclick="searchByTopic('knowledge')" class="suggestion-btn">Knowledge</button>
                            <button onclick="searchByTopic('family')" class="suggestion-btn">Family</button>
                        </div>
                        <p>Or ask your question in a different way:</p>
                        <ul>
                            <li>"What does Islam say about..."</li>
                            <li>"How to..."</li>
                            <li>"Why is..."</li>
                            <li>"Tell me about..."</li>
                        </ul>
                    </div>
                `;
                return;
            }

            resultsCount.textContent = `${results.length} results found for "${query}"`;
            resultsSection.style.display = 'block';

            verseResults.innerHTML = '';
            
            // Show AI-generated summary if available
            if (results.length > 0) {
                const aiResponse = islamicAI.generateResponse(query, results);
                if (aiResponse.suggestions && aiResponse.suggestions.length > 0) {
                    const summaryDiv = document.createElement('div');
                    summaryDiv.className = 'ai-summary';
                    summaryDiv.innerHTML = `
                        <h3>ü§ñ AI Assistant Summary</h3>
                        <p>${aiResponse.text}</p>
                        <div class="suggestions">
                            <h4>üí° Related Topics:</h4>
                            <div class="suggestion-buttons">
                                ${aiResponse.suggestions.map(suggestion => 
                                    `<button onclick="searchByTopic('${suggestion.toLowerCase().split(' ')[0]}')" class="suggestion-btn">${suggestion}</button>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                    verseResults.appendChild(summaryDiv);
                }
            }

            results.forEach((item, index) => {
                const resultItem = createResultItem(item, index);
                verseResults.appendChild(resultItem);
            });
        }

        function createResultItem(item, index) {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'verse-item';
            
            let sourceBadge = '';
            let authenticationInfo = '';
            let relevanceInfo = '';
            
            if (item.source === 'Hadith') {
                sourceBadge = `<div class="verse-source">${item.source}</div>`;
                authenticationInfo = `
                    <div class="hadith-authentication">
                        <div class="level">Authentication: ${item.authentication}</div>
                        <div class="narrator">${item.narrator}</div>
                    </div>
                `;
            } else {
                sourceBadge = `<div class="verse-topic">${item.source}</div>`;
            }

            // Add relevance score if available
            if (item.relevanceScore) {
                const percentage = Math.round(item.relevanceScore * 100);
                relevanceInfo = `<div class="relevance-score">Relevance: ${percentage}%</div>`;
            }

            // Add matched terms if available
            let matchedTermsInfo = '';
            if (item.matchedTerms && item.matchedTerms.length > 0) {
                matchedTermsInfo = `
                    <div class="matched-terms">
                        <small>Matched: ${item.matchedTerms.join(', ')}</small>
                    </div>
                `;
            }
            
            resultDiv.innerHTML = `
                <div class="verse-header">
                    <div class="verse-reference">${item.reference}</div>
                    ${sourceBadge}
                    ${relevanceInfo}
                </div>
                <div class="verse-text">
                    ${item.arabic ? `<div class="verse-arabic">${item.arabic}</div>` : ''}
                    <div class="verse-translation">${item.translation}</div>
                </div>
                <div class="verse-context">
                    <h4>Context & Meaning</h4>
                    <p>${item.context}</p>
                </div>
                ${authenticationInfo}
                ${matchedTermsInfo}
                <div class="verse-actions">
                    <button onclick="copyToClipboard('${item.reference}')" class="action-btn">üìã Copy Reference</button>
                    <button onclick="shareVerse('${item.reference}')" class="action-btn">üì§ Share</button>
                    <button onclick="addToFavorites(${index})" class="action-btn">‚≠ê Favorite</button>
                </div>
            `;
            
            return resultDiv;
        }

        // Enhanced search by topic with AI suggestions
        function searchByTopic(topic) {
            document.getElementById('searchInput').value = topic;
            performSearch();
            
            // Show AI suggestions for the topic
            setTimeout(() => {
                const suggestions = islamicAI.findRelatedTopics(topic.charAt(0).toUpperCase() + topic.slice(1));
                if (suggestions.length > 0) {
                    showTopicSuggestions(topic, suggestions);
                }
            }, 100);
        }

        // Show topic suggestions
        function showTopicSuggestions(currentTopic, suggestions) {
            const suggestionsDiv = document.createElement('div');
            suggestionsDiv.className = 'topic-suggestions';
            suggestionsDiv.innerHTML = `
                <h4>üîç Related to "${currentTopic}":</h4>
                <div class="suggestion-buttons">
                    ${suggestions.map(suggestion => 
                        `<button onclick="searchByTopic('${suggestion.toLowerCase()}')" class="suggestion-btn">${suggestion}</button>`
                    ).join('')}
                </div>
            `;
            
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.appendChild(suggestionsDiv);
        }

        // Utility functions
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('Reference copied to clipboard!', 'success');
            }).catch(() => {
                showNotification('Failed to copy reference', 'error');
            });
        }

        function shareVerse(reference) {
            if (navigator.share) {
                navigator.share({
                    title: 'Islamic Knowledge',
                    text: `Check out this Islamic reference: ${reference}`,
                    url: window.location.href
                });
            } else {
                copyToClipboard(reference);
                showNotification('Reference copied! Share it with others.', 'info');
            }
        }

        function addToFavorites(index) {
            showNotification('Feature coming soon!', 'info');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Event handlers
        function handleSearch(event) {
            if (event.key === "Enter") {
                performSearch();
            }
        }

        function setSource(source) {
            currentSource = source;
            
            // Update button states
            document.querySelectorAll('.source-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update search placeholder
            const searchInput = document.getElementById('searchInput');
            if (source === 'quran') {
                searchInput.placeholder = "Search Quran verses only (e.g., mercy, prayer, patience)...";
            } else if (source === 'hadith') {
                searchInput.placeholder = "Search Hadiths only (e.g., kindness, prayer, patience)...";
            } else {
                searchInput.placeholder = "Ask any Islamic question (e.g., 'What does Islam say about mercy?', 'How to pray?', 'Why is knowledge important?')";
            }
        }

        // Auto-wisdom functions
        function startAutoWisdomTimer() {
            autoWisdomTimer = setInterval(updateAutoWisdom, 8000);
        }

        function updateAutoWisdom() {
            const wisdomElement = document.getElementById('autoWisdom');
            if (wisdomElement) {
                const wisdom = autoWisdom[autoWisdomIndex];
                wisdomElement.innerHTML = `
                    <h3>üí° Daily Islamic Wisdom</h3>
                    <div class="wisdom-text">"${wisdom.text}"</div>
                    <div class="wisdom-source">- ${wisdom.reference} (${wisdom.source})</div>
                    <div class="wisdom-category">${wisdom.category || 'Islamic Wisdom'}</div>
                `;
                autoWisdomIndex = (autoWisdomIndex + 1) % autoWisdom.length;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            startAutoWisdomTimer();
            updateAutoWisdom();
        });
    </script>
</body>
</html>
